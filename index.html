<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDda1QeqAj0B6I4alDG7WLNN-PWF0xrH9E",
    authDomain: "almacen-6278f.firebaseapp.com",
    projectId: "almacen-6278f",
    storageBucket: "almacen-6278f.firebasestorage.app",
    messagingSenderId: "58793819823",
    appId: "1:58793819823:web:b30ebd040a4051258ede5a",
    measurementId: "G-1V6PKG2NNR"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let ultimaVez = 0;

  window.enviarComentario = async function () {
    const ahora = Date.now();
    if (ahora - ultimaVez < 180000) {
      alert("üïí Espera 3 minutos antes de enviar otro comentario.");
      return;
    }

    const texto = document.getElementById("comentario").value.trim();
    if (texto === "") {
      alert("Escribe algo primero.");
      return;
    }

    if (texto.length > 35) {
      alert("üõë M√°ximo 35 caracteres.");
      return;
    }

    try {
      await addDoc(collection(db, "comentarios"), {
        mensaje: texto,
        fecha: new Date()
      });

      alert("‚úÖ Comentario enviado correctamente");

      const li = document.createElement("li");
      li.textContent = texto;
      document.getElementById("listaComentarios").appendChild(li);
      document.getElementById("comentario").value = "";

      ultimaVez = ahora;
    } catch (error) {
      alert("‚ùå Error al guardar el comentario: " + error.message);
      console.error(error);
    }
  };
</script>
